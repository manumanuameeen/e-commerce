<%- include('../partials/header') %>

<div class="container mt-5">
    <div class="row">
        <div class="col-lg-8">
            <h2 class="mb-4">Your Cart</h2>
            
            <% if (cart && cart.items && cart.items.length > 0) { %>
                <% cart.items.forEach(function(cartItem) { %>
                    <div class="card mb-3" data-product-id="<%= cartItem.product._id %>">
                        <div class="card-body d-flex align-items-center">
                            <img 
                                src="<%= cartItem.product.image %>" 
                                alt="<%= cartItem.product.name %>" 
                                class="img-thumbnail" 
                                style="width: 100px; height: 100px; object-fit: cover;"
                            >
                            <div class="ml-3 flex-grow-1">
                                <h5><%= cartItem.product.name %></h5>
                                <p>Price: $<%= cartItem.product.price.toFixed(2) %></p>
                                
                                <div class="quantity-control d-flex align-items-center">
                                    <button 
                                        class="btn btn-sm btn-outline-secondary decrease-qty" 
                                        data-product-id="<%= cartItem.product._id %>"
                                    >-</button>
                                    
                                    <input 
                                        type="number" 
                                        class="form-control form-control-sm mx-2 text-center qty-input" 
                                        value="<%= cartItem.quantity %>" 
                                        min="1" 
                                        max="<%= cartItem.product.stock %>"
                                        data-product-id="<%= cartItem.product._id %>"
                                    >
                                    
                                    <button 
                                        class="btn btn-sm btn-outline-secondary increase-qty" 
                                        data-product-id="<%= cartItem.product._id %>"
                                    >+</button>
                                </div>
                                
                                <p class="mt-2">
                                    Subtotal: $<%= (cartItem.quantity * cartItem.product.price).toFixed(2) %>
                                </p>
                                
                                <button 
                                    class="btn btn-sm btn-danger remove-from-cart" 
                                    data-product-id="<%= cartItem.product._id %>"
                                >
                                    Remove
                                </button>
                            </div>
                        </div>
                    </div>
                <% }); %>
                
                <div class="card">
                    <div class="card-body">
                        <h4>Total: $<%= cart.totalPrice.toFixed(2) %></h4>
                        <button class="btn btn-primary btn-lg btn-block">
                            Proceed to Checkout
                        </button>
                    </div>
                </div>
            <% } else { %>
                <div class="alert alert-info">
                    Your cart is empty. 
                    <a href="/shop" class="alert-link">Continue Shopping</a>
                </div>
            <% } %>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Remove from cart
    document.querySelectorAll('.remove-from-cart').forEach(button => {
        button.addEventListener('click', function() {
            const productId = this.dataset.productId;
            fetch('/cart/remove', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ productId })
            })
            .then(response => response.json())
            .then(data => {
                if (data.cart) {
                    location.reload();
                }
            });
        });
    });

    // Quantity controls
    document.querySelectorAll('.qty-input').forEach(input => {
        input.addEventListener('change', function() {
            const productId = this.dataset.productId;
            const quantity = parseInt(this.value);
            
            fetch('/cart/update', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ productId, quantity })
            })
            .then(response => response.json())
            .then(data => {
                if (data.cart) {
                    location.reload();
                }
            });
        });
    });
});
</script>

<%- include('../partials/footer') %>