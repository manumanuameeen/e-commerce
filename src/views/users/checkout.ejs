<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">
<style>
    .breadcrumb_bg {
        background: #f8f8f8;
        padding: 40px 0;
        margin-bottom: 30px;
        background-image: url('https://i.pinimg.com/736x/5a/1a/85/5a1a85ad7afacac679bfdda2d06ba7e5.jpg');
        background-size: cover;
        background-position: center;
        background-repeat: no-repeat;
    }

    .breadcrumb_iner {
        text-align: left;
        padding: 0 15px;
    }

    .breadcrumb_iner_item h2 {
        font-size: 32px;
        font-weight: 600;
        margin-bottom: 8px;
        color: #000000;
        /* Changed to pure black */
    }

    .breadcrumb_iner_item p {
        font-size: 14px;
        color: #000000;
        /* Changed to pure black */
        margin: 0;
    }

    .breadcrumb_iner_item p span {
        margin: 0 8px;
        color: #000000;
        /* Changed to pure black and fixed the syntax error */
    }

    .breadcrumb_iner_item a {
        color: #000000;
        /* Added this to ensure links are also black */
        text-decoration: none;
    }

    .breadcrumb_iner_item a:hover {
        color: #333333;
        /* Slightly lighter black on hover */
    }

    .modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
        z-index: 1000;
    }

    .modal-content {
        position: relative;
        background-color: #fff;
        margin: 5% auto;
        padding: 20px;
        width: 90%;
        max-width: 600px;
        border-radius: 8px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        animation: slideIn 0.3s ease-out;
    }

    @keyframes slideIn {
        from {
            transform: translateY(-100px);
            opacity: 0;
        }

        to {
            transform: translateY(0);
            opacity: 1;
        }
    }

    .close {
        position: absolute;
        right: 20px;
        top: 15px;
        font-size: 24px;
        font-weight: bold;
        color: #666;
        cursor: pointer;
        transition: color 0.3s;
    }

    .close:hover {
        color: #000;
    }

    .form-group {
        margin-bottom: 20px;
    }

    .form-group label {
        display: block;
        margin-bottom: 8px;
        font-weight: 600;
        color: #333;
    }

    .form-control {
        width: 100%;
        padding: 12px;
        border: 2px solid #e5e5e5;
        border-radius: 6px;
        font-size: 14px;
        transition: border-color 0.3s;
    }

    .form-control:focus {
        outline: none;
        border-color: #000;
    }

    .row {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 20px;
        margin-bottom: 20px;
    }

    .alert {
        padding: 15px;
        margin-bottom: 20px;
        border-radius: 6px;
    }

    .alert-success {
        background-color: #d4edda;
        color: #155724;
        border: 1px solid #c3e6cb;
    }

    .alert-danger {
        background-color: #f8d7da;
        color: #721c24;
        border: 1px solid #f5c6cb;
    }

    .checkout-container {
        max-width: 1200px;
        margin: 40px auto;
        padding: 0 15px;
    }

    .checkout-title {
        font-size: 28px;
        font-weight: 700;
        margin-bottom: 30px;
    }

    .checkout-grid {
        display: grid;
        grid-template-columns: 2fr 1fr;
        gap: 30px;
    }

    .checkout-card {
        background: white;
        border-radius: 8px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        padding: 24px;
        margin-bottom: 24px;
    }

    .section-heading {
        display: flex;
        align-items: center;
        margin-bottom: 20px;
        font-size: 20px;
        font-weight: 600;
    }

    .section-heading i {
        margin-right: 10px;
        color: #333;
    }

    .address-box {
        border: 2px solid #e5e5e5;
        border-radius: 8px;
        padding: 16px;
        margin-bottom: 16px;
        cursor: pointer;
        transition: all 0.3s;
    }

    .address-box.selected {
        border-color: #000;
        background-color: #f8f9fa;
    }

    .address-content {
        display: flex;
        gap: 15px;
    }

    .address-details p {
        margin-bottom: 5px;
        color: #4a4a4a;
    }

    .address-details .name {
        font-weight: 600;
        color: #000;
    }

    .add-address-btn {
        color: #000;
        font-weight: 600;
        background: none;
        border: none;
        padding: 8px 0;
        cursor: pointer;
    }

    .add-address-btn:hover {
        text-decoration: underline;
    }

    .payment-option {
        border: 1px solid #e5e5e5;
        border-radius: 8px;
        padding: 16px;
    }

    .order-item {
        display: flex;
        justify-content: space-between;
        align-items: start;
        margin-bottom: 16px;
    }

    .order-details h4 {
        font-weight: 600;
        margin-bottom: 4px;
    }

    .order-quantity {
        color: #666;
        font-size: 14px;
    }

    .order-summary {
        border-top: 1px solid #e5e5e5;
        margin-top: 20px;
        padding-top: 20px;
    }

    .summary-row {
        display: flex;
        justify-content: space-between;
        margin-bottom: 10px;
        color: #4a4a4a;
    }

    .summary-row.total {
        font-weight: 700;
        font-size: 18px;
        color: #000;
        margin-top: 15px;
    }

    .place-order-btn {
        width: 100%;
        background: #000;
        color: white;
        border: none;
        padding: 15px;
        border-radius: 8px;
        font-weight: 600;
        cursor: pointer;
        margin-top: 20px;
        transition: background-color 0.3s;
    }

    .place-order-btn:hover {
        background: #333;
    }

    .delivery-info {
        display: flex;
        align-items: center;
        justify-content: center;
        color: #666;
        font-size: 14px;
        margin-top: 16px;
    }

    .customer-details {
        margin-bottom: 16px;
    }

    .form-group {
        margin-bottom: 16px;
    }

    .form-group label {
        display: block;
        margin-bottom: 8px;
        font-weight: 600;
        color: #333;
    }

    .form-group input {
        width: 100%;
        padding: 10px;
        border: 1px solid #e5e5e5;
        border-radius: 4px;
        font-size: 14px;
    }

    .form-group input:focus {
        outline: none;
        border-color: #000;
    }

    .payment-methods {
        display: grid;
        gap: 16px;
    }

    .payment-option {
        border: 1px solid #e5e5e5;
        border-radius: 8px;
        padding: 16px;
        cursor: pointer;
        transition: all 0.3s;
    }

    .payment-option:hover {
        border-color: #000;
    }

    .payment-option.selected {
        border-color: #000;
        background-color: #f8f9fa;
    }

    .payment-content {
        display: flex;
        gap: 15px;
        align-items: center;
    }

    .payment-icon {
        font-size: 24px;
        color: #333;
    }

    .payment-details p {
        margin: 0;
    }

    .payment-details .name {
        font-weight: 600;
        color: #000;
    }

    .payment-details .description {
        font-size: 14px;
        color: #666;
    }

    .required {
        color: red;
        margin-left: 2px;
    }

    .customer-details-display {
        margin-bottom: 16px;
    }

    .details-group {
        margin-bottom: 16px;
    }

    .details-group label {
        display: block;
        margin-bottom: 8px;
        font-weight: 600;
        color: #333;
    }

    .detail-value {
        padding: 10px 0;
        color: #4a4a4a;
        font-size: 14px;
        margin: 0;
        border-bottom: 1px solid #e5e5e5;
    }

    .details-group:last-child {
        margin-bottom: 0;
    }

    .details-group:last-child .detail-value {
        border-bottom: none;
    }


    .delivery-info i {
        margin-right: 8px;
    }

    @media (max-width: 768px) {
        .checkout-grid {
            grid-template-columns: 1fr;
        }
    }
</style>

<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>Checkout</title>

    <!-- External CSS -->
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="stylesheet" href="css/animate.css">
    <link rel="stylesheet" href="css/owl.carousel.min.css">
    <link rel="stylesheet" href="css/all.css">
    <link rel="stylesheet" href="css/flaticon.css">
    <link rel="stylesheet" href="css/themify-icons.css">
    <link rel="stylesheet" href="css/style.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">

    <style>
        /* Header specific styles */
        .main_menu {
            background: white;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            margin-bottom: 40px;
        }

        .header_icon i {
            font-size: 20px;
            color: #333;
            margin-left: 20px;
        }

        .dropdown-content {
            display: none;
            position: absolute;
            background-color: white;
            min-width: 160px;
            box-shadow: 0px 8px 16px rgba(0, 0, 0, 0.1);
            z-index: 1000;
            right: 0;
            border-radius: 8px;
        }

        .breadcrumb {
            --bs-breadcrumb-padding-y: 100px;
        }

        /* Layout adjustments */
        body {
            background-color: #f8f9fa;
            min-height: 100vh;
        }

        .checkout-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 40px 15px;
        }

        /* Existing styles from your code */


        /* Additional layout improvements */
        .checkout-grid {
            margin-top: 136px;
        }

        .checkout-card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 15px rgba(0, 0, 0, 0.05);
            margin-bottom: 25px;
        }

        .section-heading {
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
        }

        .modal-content {
            border-radius: 12px;
        }

        /* Responsive improvements */
        @media (max-width: 768px) {
            .checkout-container {
                padding: 20px 15px;
            }

            .checkout-title {
                font-size: 24px;
                margin-bottom: 20px;
            }

            .checkout-grid {
                gap: 20px;
            }
        }
    </style>
</head>

<body>
    <!-- Header -->
    <header class="main_menu home_menu">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-lg-12">
                    <nav class="navbar navbar-expand-lg navbar-light">
                        <a class="navbar-brand" href="/home">
                            <img src="/img/logo.png" alt="logo">
                        </a>
                        <button class="navbar-toggler" type="button" data-toggle="collapse"
                            data-target="#navbarSupportedContent">
                            <span class="menu_icon"><i class="fas fa-bars"></i></span>
                        </button>

                        <div class="collapse navbar-collapse main-menu-item" id="navbarSupportedContent">
                            <ul class="navbar-nav">
                                <li class="nav-item"><a class="nav-link" href="/">Home</a></li>
                                <li class="nav-item"><a class="nav-link" href="/shop">Shop</a></li>
                                <li class="nav-item"><a class="nav-link" href="/contact">Contact</a></li>
                            </ul>
                        </div>

                        <div class="header_icon d-flex align-items-center">
                            <a href="/wishlist"><i class="ti-heart"></i></a>
                            <a href="/cart"><i class="fas fa-cart-plus"></i></a>
                        </div>

                        <% if (locals.user) { %>
                            <div class="dropdown">
                                <a href="/profile" class="btn">
                                    <p class="mb-0">
                                        <%=user.name%>
                                    </p>
                                </a>
                                <div class="dropdown-content">
                                    <a href="/profile">Profile</a>
                                    <a href="/logout">Logout</a>
                                </div>
                            </div>
                            <% } else { %>
                                <a href="/login" class="btn btn-primary ml-2">Login</a>
                                <a href="/signup" class="btn btn-primary ml-2">Sign Up</a>
                                <% } %>
                    </nav>
                </div>
            </div>
        </div>
    </header>

    <section class="breadcrumb breadcrumb_bg">
        <div class="container">
            <div class="breadcrumb_iner">
                <div class="breadcrumb_iner_item">
                    <h2>Checkout</h2>
                    <p class="breadcrumb_iner_item p">Home <span>-</span> Shop <span>-</span> Cart<span>-</span>Checkout
                    </p>
                </div>
            </div>
        </div>
    </section>

    <div class="checkout-container">
        <h1 class="checkout-title">Checkout</h1>

        <div class="checkout-grid">
            <!-- Left Column -->
            <div class="main-content">
                <!-- Customer Details Section -->
                <!-- Customer Details Section -->
                <div class="checkout-card">
                    <div class="section-heading">
                        <i class="fas fa-user"></i>
                        Customer Details
                    </div>

                    <div class="customer-details-display">
                        <div class="details-group">
                            <label>Full Name</label>
                            <p class="detail-value">
                                <%=user.name%>
                            </p>
                        </div>

                        <div class="details-group">
                            <label>Email</label>
                            <p class="detail-value">
                                <%=user.email%>
                            </p>
                        </div>

                        <div class="details-group">
                            <label>Phone Number</label>
                            <p class="detail-value">
                                <%=user.phone%>
                            </p>
                        </div>
                    </div>
                </div>
                <div class="checkout-card">
                    <div class="section-heading">
                        <i class="fas fa-map-marker-alt"></i>
                        Delivery Address
                    </div>

                    <div class="address-box selected">
                        <% if (address && address.address.length > 0) { %>
                            <% for (let addr of address.address) { %>
                                <div class="address-content">
                                    <input type="radio" name="address" value="<%= addr._id %>" >
                                    <div class="address-details">
                                        <p class="name"><%= addr.name %></p>
                                        <p><%= addr.city %></p>
                                        <p><%= addr.landMark %></p>
                                        <p><%= addr.state %></p>
                                        <p><%= addr.pincode %></p>
                                        <p><%= addr.phone %></p>
                                    </div>
                                </div>
                            <% } %>
                        <% } else { %>
                            <p>No addresses found. Please add one!</p>
                        <% } %>
                    </div>


                    <!-- Add Address Button -->
                    <button id="addAddressBtn" class="place-order-btn">+ Add New Address</button>

                    <!-- Message Container -->
                    <div id="message-container" style="display: none;">
                        <% if (locals.successMessage) { %>
                            <div id="success-message" class="alert alert-success">
                                <strong>Success!</strong>
                                <%= successMessage %>
                            </div>
                            <% } %>
                                <% if (locals.errorMessage) { %>
                                    <div id="error-message" class="alert alert-danger">
                                        <strong>Error!</strong>
                                        <%= errorMessage %>
                                    </div>
                                    <% } %>
                    </div>


                    <!-- Payment Method Section -->
                    <div class="checkout-card">
                        <div class="section-heading">
                            <i class="fas fa-credit-card"></i>
                            Payment Method
                        </div>

                        <!-- <div class="payment-methods">
                            <div class="payment-option selected">
                                <div class="payment-content">
                                    <input type="radio" name="payment" value="card" checked>
                                    <i class="fas fa-credit-card payment-icon"></i>
                                    <div class="payment-details">
                                        <p class="name">Credit/Debit Card</p>
                                        <p class="description">Pay securely with your card</p>
                                    </div>
                                </div>
                            </div> -->

                            <!-- <div class="payment-option">
                                <div class="payment-content">
                                    <input type="radio" name="payment" value="online">
                                    <i class="fas fa-mobile-alt payment-icon"></i>
                                    <div class="payment-details">
                                        <p class="name">Online Payment</p>
                                        <p class="description">UPI, Net Banking, Wallet</p>
                                    </div>
                                </div>
                            </div> -->

                            <div class="payment-option">
                                <div class="payment-content">
                                    <input type="radio" name="payment" value="Cash on Delivery">
                                    <i class="fas fa-money-bill-wave payment-icon"></i>
                                    <div class="payment-details">
                                        <p class="name">Cash on Delivery</p>
                                        <p class="description">Pay when you receive</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Right Column - Order Summary -->
                <div class="order-summary-section">
                    <div class="checkout-card">
                        <div class="section-heading">Order Summary</div>
                        <% if (cart && cart.items.length> 0) { %>
                            <% cart.items.forEach(product=> { %>
                                <div class="order-item">
                                    <div class="order-item">
                                        <div class="order-details">
                                            <h4>
                                                <%= product.ProductId.productName %>
                                            </h4>   <p class="order-quantity">Quantity: <%= product.quantity %>
                                            </p>
                                        </div>
                                    </div>

                                    <div class="order-price">$<%= product.price %>
                                    </div>
                                </div>
                                <% }) %>
                                    <div class="order-summary">
                                        <div class="summary-row">
                                            <span>Subtotal</span>
                                            <span>$<%=subTotal%></span>
                                        </div>
                                        <div class="summary-row">
                                            <span>Shipping</span>
                                            <span>Free Shipping</span>
                                        </div>
                                        <div class="summary-row total">
                                            <span>Total</span>
                                            <span>$<%=subTotal%></span>
                                        </div>
                                    </div>
                                    <% } else { %>
                                        <p>No items in the cart.</p>
                                        <% } %>
                                            <button class="place-order-btn" onclick="placeOrder()">Place Order</button>
                                            <div class="delivery-info">
                                                <i class="fas fa-truck"></i>
                                                Estimated delivery: 3-5 business days
                                            </div>
                    </div>
                </div>
            </div>

            <!-- Modal -->
            <div id="addressModal" class="modal">
                <div class="modal-content">
                    <span class="close">&times;</span>
                    <h3 style="margin-bottom: 30px; color: #333;">Add New Address</h3>

                    <form id="addressForm" method="POST" action="/checkout-address">
                        <div class="row">
                            <div class="form-group">
                                <label for="addressType">Address Type</label>
                                <input type="text" class="form-control" id="addressType" name="addressType"
                                    placeholder="Home/Office/etc." required>
                            </div>
                            <div class="form-group">
                                <label for="name">Full Name</label>
                                <input type="text" class="form-control" id="name" name="name"
                                    placeholder="Enter full name" required>
                            </div>
                        </div>

                        <div class="row">
                            <div class="form-group">
                                <label for="city">City</label>
                                <input type="text" class="form-control" id="city" name="city" placeholder="Enter city"
                                    required>
                            </div>
                            <div class="form-group">
                                <label for="state">State</label>
                                <input type="text" class="form-control" id="state" name="state"
                                    placeholder="Enter state" required>
                            </div>
                        </div>

                        <div class="row">
                            <div class="form-group">
                                <label for="landMark">Landmark</label>
                                <input type="text" class="form-control" id="landMark" name="landMark"
                                    placeholder="Nearby landmark" required>
                            </div>
                            <div class="form-group">
                                <label for="pincode">Pincode</label>
                                <input type="number" class="form-control" id="pincode" name="pincode"
                                    placeholder="6-digit pincode" required>
                            </div>
                        </div>

                        <div class="row">
                            <div class="form-group">
                                <label for="phone">Phone Number</label>
                                <input type="tel" class="form-control" id="phone" name="phone"
                                    placeholder="10-digit phone number" required>
                            </div>
                            <div class="form-group">
                                <label for="altPhone">Alternate Phone (Optional)</label>
                                <input type="tel" class="form-control" id="altPhone" name="altPhone"
                                    placeholder="Alternate mobile number">
                            </div>
                        </div>

                        <button type="submit" class="place-order-btn">Add Address</button>
                    </form>
                </div>
            </div>
            <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
            <script src="js/jquery-1.12.1.min.js"></script>
            <script src="js/bootstrap.min.js"></script>
            <script>
                // This script checks if there is a success or error message to show
                document.addEventListener('DOMContentLoaded', function () {
                    // Fetch success and error messages passed from the server
                    const successMessage = '<%= successMessage %>';
                    const errorMessage = '<%= errorMessage %>';

                    const successElement = document.getElementById('success-message');
                    const errorElement = document.getElementById('error-message');
                    const messageContainer = document.getElementById('message-container');
                    if (successMessage) {
                        successElement.style.display = 'block';
                        messageContainer.style.display = 'block';
                    }

                    // Display the error message if available
                    if (errorMessage) {
                        errorElement.style.display = 'block';
                        messageContainer.style.display = 'block';
                    }
                });

            </script>

            <script>
                // Get modal elements
                const modal = document.getElementById('addressModal');
                const btn = document.getElementById('addAddressBtn');
                const span = document.getElementsByClassName('close')[0];
                const messageContainer = document.getElementById('message-container');

                // Open modal
                btn.onclick = function () {
                    modal.style.display = 'block';
                }

                // Close modal
                span.onclick = function () {
                    modal.style.display = 'none';
                }

                // Close modal when clicking outside
                window.onclick = function (event) {
                    if (event.target == modal) {
                        modal.style.display = 'none';
                    }
                }

                // Handle form submission
                document.getElementById('addressForm').onsubmit = function (e) {
                    // You can add form validation here if needed
                    const phone = document.getElementById('phone').value;
                    const pincode = document.getElementById('pincode').value;

                    if (phone.length !== 10) {
                        e.preventDefault();
                        alert('Phone number must be 10 digits');
                        return false;
                    }

                    if (pincode.length !== 6) {
                        e.preventDefault();
                        alert('Pincode must be 6 digits');
                        return false;
                    }
                }

                // Show success/error message if present
                document.addEventListener('DOMContentLoaded', function () {
                    const successMessage = document.getElementById('success-message');
                    const errorMessage = document.getElementById('error-message');

                    if (successMessage || errorMessage) {
                        messageContainer.style.display = 'block';
                        setTimeout(() => {
                            messageContainer.style.display = 'none';
                        }, 5000); // Hide after 5 seconds
                    }
                });


</script>




<script>

async function placeOrder() {
    const selectedAddressElem = document.querySelector('input[name="address"]:checked');
    const selectedPayment = document.querySelector('input[name="payment"]:checked');
    
    if (!selectedAddressElem) {
        Swal.fire({
            title: 'Error!',
            text: 'Please select a delivery address',
            icon: 'error',
            confirmButtonText: 'OK'
        });
        return;
    }
    
    if (!selectedPayment) {
        Swal.fire({
            title: 'Error!',
            text: 'Please select a payment method',
            icon: 'error',
            confirmButtonText: 'OK'
        });
        return;
    }

    try {
        const response = await fetch('/placeOrder', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                selectedAddress: selectedAddressElem.value,  
                paymentMethod: selectedPayment.value
            })
        });

        const data = await response.json();
        
        if (data.success) {
            Swal.fire({
                title: 'Order Placed!',
                text: 'Your order has been placed successfully.',
                icon: 'success',
                confirmButtonText: 'View Order'
            }).then((result) => {
                if (result.isConfirmed) {
    window.location.href = `/orderSuccess?orderId=${data.orderId}`;

                }
            });
        } else {
            Swal.fire({
                title: 'Error!',
                text: data.message || 'Failed to place order. Please try again.',
                icon: 'error',
                confirmButtonText: 'OK'
            });
        }
    } catch (error) {
        console.error('Error:', error);
        Swal.fire({
            title: 'Error!',
            text: 'An error occurred. Please try again.',
            icon: 'error',
            confirmButtonText: 'OK'
        });
    }
}
 </script>



            